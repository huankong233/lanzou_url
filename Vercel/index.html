<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta http-equiv="X-UA-Compatible" content="IE=edge" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>API 测试界面</title>
    <style>
      #get {
        max-width: 960px;
      }

      #finta {
        max-width: 960px;
      }

      #main button {
        display: block;
        margin: 0 auto;
      }
    </style>
    <link rel="stylesheet" href="https://unpkg.com/mdui@1.0.2/dist/css/mdui.min.css" />
  </head>
  <body
    class="mdui-drawer-body-left mdui-appbar-with-toolbar mdui-theme-primary-indigo mdui-theme-accent-pink mdui-theme-layout-dark mdui-bottom-nav-fixed"
    id="p-d"
  >
    <header class="appbar mdui-appbar mdui-appbar-fixed">
      <div class="mdui-toolbar mdui-color-theme">
        <span
          class="mdui-btn mdui-btn-icon mdui-ripple mdui-ripple-white"
          mdui-drawer="{target: '#drawer', swipe: true}"
        >
          <i class="mdui-icon material-icons">menu</i>
        </span>
        <a href="/" class="mdui-typo-headline">Vercel-Lanzou-Get Demo</a>
        <div class="mdui-toolbar-spacer"></div>
      </div>
    </header>
    <div class="mdui-drawer" id="drawer">
      <ul class="mdui-list">
        <a href="/">
          <li class="mdui-list-item mdui-ripple">
            <i class="mdui-list-item-icon mdui-icon material-icons">folder</i>
            <div class="mdui-list-item-content">主页</div>
          </li>
        </a>
        <a href="/setting.html">
          <li class="mdui-list-item mdui-ripple">
            <i class="mdui-list-item-icon mdui-icon material-icons">settings</i>
            <div class="mdui-list-item-content">设置</div>
          </li>
        </a>
      </ul>
    </div>
    <div id="main">
      <div class="mdui-panel-item mdui-panel-item-open" id="get">
        <div class="mdui-panel-item-header">获取信息</div>
        <div class="mdui-panel-item-body">
          <div class="mdui-textfield mdui-textfield-floating-label">
            <label class="mdui-textfield-label">蓝奏云分享链接</label>
            <input class="mdui-textfield-input" type="text" id="lanzou" />
          </div>
          <div class="mdui-textfield mdui-textfield-floating-label">
            <label class="mdui-textfield-label">蓝奏云文件ID</label>
            <input class="mdui-textfield-input" type="text" id="lanzou_id" />
          </div>
          <div class="mdui-textfield mdui-textfield-floating-label">
            <label class="mdui-textfield-label">密码（可不填）</label>
            <input class="mdui-textfield-input" type="text" id="pwd" />
          </div>
        </div>
      </div>
      <button class="mdui-btn mdui-btn-raised mdui-ripple mdui-color-theme-accent" onclick="get()">
        请求
      </button>
    </div>
    <div class="mdui-panel-item mdui-panel-item-open" id="finta">
      <div class="mdui-panel-item-header">结果显示 （仅支持URL）</div>
      <div class="mdui-panel-item-body" id="fin">
        <span style="width: 100%; word-break: break-word; white-space: pre-line"
          >还没有结果哦!</span
        >
      </div>
    </div>
    <script src="https://unpkg.com/mdui@1.0.2/dist/js/mdui.min.js"></script>
    <script>
      mdui.snackbar({
        message: 'Demo测试使用',
        position: 'right-bottom'
      })

      let channel = localStorage.getItem('apipath')
      if (!channel) {
        channel = './api'
      }

      function get() {
        mdui.snackbar({
          message: '获取中',
          position: 'right-bottom'
        })

        let url = document.getElementById('lanzou').value
        let id = document.getElementById('lanzou_id').value
        let pass = document.getElementById('pwd').value
        let fullUrl = channel

        if (!id && !url) {
          alert('请先填写文件ID或蓝奏分享地址')
        }

        if (id) {
          fullUrl += `/?id=${id}`
        } else {
          fullUrl += `/?url=${url}`
        }

        if (pass) {
          fullUrl += `&pass=${pass}`
        }

        fetch(fullUrl)
          .then(res => res.json())
          .then(res => (document.getElementById('fin').innerHTML = JSON.stringify(res.data)))
          .catch(e => {
            console.log('error: ' + e.toString())
            document.getElementById('fin').innerHTML = e.toString()
          })
      }
    </script>
  </body>
</html>
